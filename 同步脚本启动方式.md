## 同步脚本启动方式



- 手动跑脚本

  1. 在rancher创建手动跑脚本的APP

  2. 用screen管理窗口，防止rancher退出后，关闭同步进程

     ```shell
     apt-get update && apt-get install vim -y && apt-get install screen -y && apt-get install less -y
     
     screen -S job -s bash（创建job的会话）
     ```

     

  3. 手动同步命令

     ```shell
     python manage.py es_sync_ad_product --max_flush_cnt=1000 --db_dsn=alishh.ag-db-40.adData --query="select ad_id as _last_id, ad_id, product_id, 'adData.ad_product' as __table from ad_product  where ad_id > %s limit 3000"
     ```

     

  4. 恢复会话

     `screen -ls `所有会话 

     （attached）状态会话 `screen -d -r yourname `-> 结束当前session并回到yourname这个session

- 自动跑脚本

  ##### 跑全量数据前，先把正式脚本的消费占位，防止数据丢失

  1. 登陆对应kafka机器

     `ssh -p36000 kafka-00.ag.alishh`

  2. 消费kafka的一个数据作为新的kafka组别消费的开端

     ```shell
   ./bin/kafka-console-consumer.sh --bootstrap-server 172.19.33.10:9092 --topic binlog-ag-db-41-addata-正式脚本的监控topic --max-messages 1  --consumer-property group.id=正式脚本的组
     ```
  
     
  
  3. 部署正式跑脚本服务